<Page x:Class="GestionOceanBijoux.Views.ProduitView"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:local="clr-namespace:GestionOceanBijoux.Views"
      xmlns:viewModel="clr-namespace:GestionOceanBijoux.ViewModels"
      d:DataContext="{d:DesignInstance Type=viewModel:ProduitViewModel}"
      mc:Ignorable="d" 
      d:DesignHeight="450" d:DesignWidth="800"
      Title="ProduitView">

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Margin="20">

            <!-- FORMULAIRE D'AJOUT -->
            <Border Background="{StaticResource SecondaryBrush}" Padding="20" CornerRadius="10" Margin="0,0,0,20">
                <StackPanel>
                    <TextBlock Text="Ajouter un nouveau produit" FontSize="16" FontWeight="Bold" Foreground="{StaticResource AccentBrush}" TextAlignment="Center" Margin="0,0,0,10"/>
                    <TextBlock Text="Nom du produit"/>
                    <TextBox Text="{Binding NomProduit, UpdateSourceTrigger=PropertyChanged}" Background="White" Margin="0,5"/>
                    <TextBlock Text="Prix (ex : 19.90)"/>
                    <TextBox Text="{Binding PrixProduit, UpdateSourceTrigger=PropertyChanged}" Background="White" Margin="0,5"/>
                    <TextBlock Text="Stock disponible"/>
                    <TextBox Text="{Binding StockProduit, UpdateSourceTrigger=PropertyChanged}" Background="White" Margin="0,5"/>
                    <Button Content="Ajouter le produit" Command="{Binding AjouterProduitCommand}" Background="{StaticResource PrimaryBrush}" Foreground="White" FontWeight="Bold" Padding="8" Margin="0,10,0,0"/>
                </StackPanel>
            </Border>

            <!-- TABLEAU PRODUITS EN ÉDITION DIRECTE -->
            <DataGrid ItemsSource="{Binding Produits}" AutoGenerateColumns="False" Margin="0,0,0,20" CanUserAddRows="False" IsReadOnly="False">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Id" Binding="{Binding id}" IsReadOnly="True" Width="50"/>
                    <DataGridTextColumn Header="Nom" Binding="{Binding nom, Mode=TwoWay}" Width="150"/>
                    <DataGridTextColumn Header="Prix (€)" Binding="{Binding prix, Mode=TwoWay}" Width="80"/>
                    <DataGridTextColumn Header="Stock" Binding="{Binding stock, Mode=TwoWay}" Width="60"/>
                    <DataGridTextColumn Header="Catégorie" Binding="{Binding categorie_id, Mode=TwoWay}" Width="80"/>
                    <DataGridTextColumn Header="Matériau" Binding="{Binding materiau, Mode=TwoWay}" Width="100"/>
                    <DataGridTextColumn Header="Style" Binding="{Binding style, Mode=TwoWay}" Width="100"/>
                    <DataGridTextColumn Header="Dimensions" Binding="{Binding dimensions, Mode=TwoWay}" Width="120"/>
                    <DataGridTextColumn Header="Fabrication" Binding="{Binding fabrication, Mode=TwoWay}" Width="150"/>

                    <!-- Enregistrer -->
                    <DataGridTemplateColumn Header="Enregistrer" Width="100">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Button Content="💾" Background="#C4E1C1" Foreground="Black" Padding="5"
                                        Command="{Binding DataContext.EnregistrerModificationsProduitCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                        CommandParameter="{Binding}" ToolTip="Enregistrer les modifications" />
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>

                    <!-- Supprimer -->
                    <DataGridTemplateColumn Header="Supprimer" Width="100">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Button Content="🗑" Background="#FFB3B3" Foreground="Black"
                                        Command="{Binding DataContext.SupprimerProduitCommand, RelativeSource={RelativeSource AncestorType=DataGrid}}"
                                        CommandParameter="{Binding}" Padding="5" ToolTip="Supprimer ce produit" />
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>

        </StackPanel>
    </ScrollViewer>
</Page>
